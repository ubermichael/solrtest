{% extends 'base.html.twig' %}

{% block title %}Search{% endblock %}

 {% block pageheader %}
     <h1>Search</h1>
     {% if qr %}
         <p class="count">
             Displaying {{ qr.count }} results from {{ start }} to {{ end }} of {{ qr.total }} total.
         </p>
     {% endif %}
 {% endblock %}

{% block body %}

    <form method="get" action="{{ path('solr') }}" class="form-horizontal">
        <div class='row'>
            <div class='col-sm-12'>
                <fieldset>
                    <div class='form-group'>
                        <label class='col-sm-2 control-label' for='q'>Search term</label>
                        <div class='col-sm-10'>
                            <div class='input-group'>
                                <input type='text' name='q' id='q' class='form-control' value='{{ q }}'>
                                <span class="input-group-btn">
                            <button class="btn btn-primary" id='btn-search' type="submit">
                                <span class='glyphicon glyphicon-search'></span>
                                Search
                            </button>
                        </span>
                            </div>
                        </div>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class='row'>
            <div class='col-sm-3'>
                {% include 'solr/partial/facet.html.twig' with {
                    'facet': qr.getFacet('type'),
                    'filter': 'type_s',
                    'header': 'Record Types'
                } %}

                {% include 'solr/partial/facet.html.twig' with {
                    'facet': qr.getFacet('genre'),
                    'filter': 'genres_ss',
                    'header': 'Genres'
                } %}
            </div>
            <div class='col-sm-9'>
                {% if qr and qr.count > 0 %}
                    <h3>Results</h3>

                    <div class='list-group'>
                    {% for i in 0..(qr.count-1) %}
                        {% set document = qr.getDocument(i) %}
                        {% set entity = qr.entity(i) %}
                        <a href='{{ entity_linker.link(entity) }}' class='list-group-item'>
                            <b>{{ document.type_s }}: {{ entity }}</b><br/>
                                {% for h in qr.getHighlighting(i) %}
                                    {{ h|join("...")|raw }}
                                {% endfor %}
                        </a>
                    {% endfor %}
                    </div>

                    <div class="navigation">
                        {{ knp_pagination_render(pagination) }}
                    </div>
                {% endif %}
            </div>
        </div>
    </form>

{% endblock %}
